{"ast":null,"code":"import _classCallCheck from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/maksimzajcev/Desktop/Work/src/components/React.visits.js\";\nimport React from 'react';\nimport Navigation from './React.nav';\nimport moment from 'moment';\nimport Loader from './React.loader';\nimport VisitsWorkspace from './React.visits.workspace';\nimport '../css/main.css';\nimport firebase from \"firebase\";\nvar urlLogs = 'http://localhost:3000/logs';\n\nvar Visits =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Visits, _React$Component);\n\n  function Visits(props) {\n    var _this;\n\n    _classCallCheck(this, Visits);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Visits).call(this, props));\n\n    _this.setDate = function (changedDate) {\n      _this.setState({\n        loading: false\n      });\n\n      var formatedDate = moment(changedDate, 'YYYY-MM-DD').format('DD.MM.YYYY');\n\n      _this.loadData(formatedDate);\n    };\n\n    _this.setPeriod = function (changedPeriod) {\n      _this.setState({\n        loading: false\n      });\n\n      _this.loadData(changedPeriod);\n    };\n\n    _this.state = {\n      activity: [],\n      loading: false,\n      settingPeriod: moment(new Date()).format('MM.YYYY')\n    };\n    return _this;\n  }\n\n  _createClass(Visits, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.loadData(this.state.settingPeriod);\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData(period) {\n      var _this2 = this;\n\n      console.log(\"Загружаемый период:\");\n      console.log(period);\n      fetch(urlLogs + '?period=' + period).then(function (response) {\n        console.log(response);\n        return response.json();\n      }).then(function (result) {\n        firebase.firestore().collection('users').onSnapshot(function (serverUpdate) {\n          // const notes = serverUpdate.docs.maps(doc => {\n          //     const data = doc.data();\n          //     data['id'] = doc.id;\n          //     return data;\n          // });\n          console.log(serverUpdate);\n        });\n\n        _this2.parseData(result, period);\n      }).catch(function (e) {\n        return console.log(e);\n      });\n    }\n  }, {\n    key: \"parseData\",\n    value: function parseData(usersLogs) {\n      var usersVisitsData = this.sortUsersViews(usersLogs);\n      this.setState({\n        activity: usersVisitsData,\n        loading: true\n      });\n    }\n  }, {\n    key: \"sortUsersViews\",\n    value: function sortUsersViews(usersLogs) {\n      var usersActivity = [];\n\n      for (var i = 0; i < usersLogs.length; i++) {\n        var logAdded = false;\n        var userActivity = {\n          userId: usersLogs[i].userId,\n          userName: usersLogs[i].name,\n          userCompany: usersLogs[i].company,\n          userViews: usersLogs[i].logItems.length,\n          userVisits: 1\n        };\n\n        for (var j = 0; j < usersActivity.length; j++) {\n          if (userActivity.userId === usersActivity[j].userId) {\n            usersActivity[j].userViews += userActivity.userViews;\n            usersActivity[j].userVisits += 1;\n            logAdded = true;\n          }\n        }\n\n        if (!logAdded) {\n          usersActivity.push(userActivity);\n        }\n      }\n\n      return usersActivity;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"maskComponent\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }, !this.state.loading ? React.createElement(Loader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      }) : null, React.createElement(\"div\", {\n        className: \"sidebar\",\n        id: \"sidebar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }, React.createElement(Navigation, {\n        activeItem: 7713,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"panel\",\n        id: \"panel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }, React.createElement(VisitsWorkspace, {\n        visitsItems: this.state.activity,\n        setPeriod: this.setPeriod,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Visits;\n}(React.Component);\n\nexport default Visits;","map":{"version":3,"sources":["/Users/maksimzajcev/Desktop/Work/src/components/React.visits.js"],"names":["React","Navigation","moment","Loader","VisitsWorkspace","firebase","urlLogs","Visits","props","setDate","changedDate","setState","loading","formatedDate","format","loadData","setPeriod","changedPeriod","state","activity","settingPeriod","Date","period","console","log","fetch","then","response","json","result","firestore","collection","onSnapshot","serverUpdate","parseData","catch","e","usersLogs","usersVisitsData","sortUsersViews","usersActivity","i","length","logAdded","userActivity","userId","userName","name","userCompany","company","userViews","logItems","userVisits","j","push","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Navigation from './React.nav';\nimport moment from 'moment';\nimport Loader from './React.loader';\nimport VisitsWorkspace from './React.visits.workspace';\nimport '../css/main.css';\nimport firebase from \"firebase\";\n\nconst urlLogs = 'http://localhost:3000/logs';\n\nclass Visits extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            activity: [],\n            loading: false,\n            settingPeriod: moment(new Date()).format('MM.YYYY')\n        };\n    }\n\n    componentWillMount() {\n        this.loadData(this.state.settingPeriod);\n    }\n\n    loadData(period) {\n        console.log(\"Загружаемый период:\");\n        console.log(period);\n        fetch(urlLogs + '?period=' + period)\n            .then(function(response) {\n                console.log(response);\n                return response.json();\n            })\n            .then(result => {\n                firebase\n                    .firestore()\n                    .collection('users')\n                    .onSnapshot(serverUpdate => {\n                        // const notes = serverUpdate.docs.maps(doc => {\n                        //     const data = doc.data();\n                        //     data['id'] = doc.id;\n                        //     return data;\n                        // });\n                        console.log(serverUpdate);\n                    });\n                this.parseData(result, period)\n            })\n            .catch(e => console.log(e));    \n    }\n\n    parseData(usersLogs) {\n        var usersVisitsData = this.sortUsersViews(usersLogs);\n        this.setState({\n            activity: usersVisitsData,\n            loading: true\n        });\n    }\n\n    setDate = (changedDate) => {\n        this.setState({\n            loading: false\n        });\n\n        var formatedDate = moment(changedDate, 'YYYY-MM-DD').format('DD.MM.YYYY');\n        this.loadData(formatedDate);\n    }\n\n    setPeriod = (changedPeriod) => {\n        this.setState({\n            loading: false\n        });\n\n        this.loadData(changedPeriod);\n    }\n\n    sortUsersViews(usersLogs) {\n\n        var usersActivity= [];\n\n        for (let i = 0; i < usersLogs.length; i++) {\n            var logAdded = false;\n            var userActivity = {\n                userId: usersLogs[i].userId,\n                userName: usersLogs[i].name,\n                userCompany: usersLogs[i].company,\n                userViews: usersLogs[i].logItems.length,\n                userVisits: 1\n            };\n            \n            for (let j = 0; j < usersActivity.length; j++) {\n                if (userActivity.userId === usersActivity[j].userId) {\n                    usersActivity[j].userViews += userActivity.userViews;\n                    usersActivity[j].userVisits += 1;\n                    logAdded = true;\n                }\n            }\n            \n            if (!logAdded) {\n                usersActivity.push(userActivity);\n            }    \n        }\n\n        return usersActivity;\n    }\n\n    render() {\n        return (\n            <div id=\"maskComponent\">\n                {!this.state.loading ? <Loader /> : null}\n                <div className=\"sidebar\" id=\"sidebar\">\n                    <Navigation activeItem={7713} />\n                </div>\n                <div className=\"panel\" id=\"panel\">\n                    <VisitsWorkspace\n                        visitsItems={this.state.activity}\n                        setPeriod={this.setPeriod}\n                    />\n                </div>                        \n            </div>\n        );\n    }\n}\n\nexport default Visits;\n\n"]},"metadata":{},"sourceType":"module"}