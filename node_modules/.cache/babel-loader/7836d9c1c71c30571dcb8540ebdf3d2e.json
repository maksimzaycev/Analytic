{"ast":null,"code":"import _classCallCheck from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/maksimzajcev/Desktop/Work/src/components/React.reports.js\";\nimport React from 'react';\nimport dataLoad from '../models/dataLoad';\nimport Navigation from './React.nav';\nimport Loader from './React.loader';\nimport moment from 'moment';\nimport ReportsWorkspace from './React.reports.workspace';\nimport '../css/main.css';\nvar COLORS = ['#4461c2', '#16a65e', '#85d357', '#ffdc45', '#ff4716', '#6ab4ec', '#b63dbc', '#fdaa19', '#fcacfd', '#8e8cd8'];\nvar urlLogs = 'http://localhost:3000/logs';\n\nvar Reports =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Reports, _React$Component);\n\n  function Reports(props) {\n    var _this;\n\n    _classCallCheck(this, Reports);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Reports).call(this, props));\n\n    _this.setDate = function (changedDate) {\n      _this.setState({\n        loading: false\n      });\n\n      var formatedDate = moment(changedDate, 'YYYY-MM-DD').format('DD.MM.YYYY');\n\n      _this.loadData(formatedDate);\n    };\n\n    _this.state = {\n      chartReports: [],\n      startDate: '',\n      finishDate: '',\n      loading: false,\n      settingPeriod: moment(new Date()).format('MM.YYYY')\n    };\n    return _this;\n  }\n\n  _createClass(Reports, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.loadData(urlLogs, this.state.settingPeriod);\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData(urlLogs, period) {\n      var usersLogs;\n      dataLoad(urlLogs + '?period=' + period).then(function (logs) {}).catch(function (logs) {\n        console.log('error ' + logs);\n      });\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData(date) {\n      var _this2 = this;\n\n      console.log(\"Загружаемая дата:\");\n      console.log(date);\n      fetch(urlLogs + '?period=' + period).then(function (response) {\n        console.log(response);\n        return response.json();\n      }).then(function (result) {\n        return _this2.parseData(result);\n      }).catch(function (e) {\n        return console.log(e);\n      });\n    }\n  }, {\n    key: \"parseData\",\n    value: function parseData(usersLogs) {\n      console.log('Пришедшие логи:');\n      console.log(usersLogs);\n      var allLogs = this.getAllLogs(usersLogs);\n      var listReports = this.getReports(allLogs);\n      var chartReports = this.getDataReports(listReports, allLogs);\n      console.log('Сформированные графики:');\n      console.log(chartReports);\n      var finishDate = moment(new Date(), 'DD.MM').subtract(1, \"days\");\n      var startDate = moment(new Date(), 'DD.MM').subtract(15, \"days\");\n      var defaultChart = this.getDefaultChart();\n      this.setState({\n        chartReports: chartReports,\n        defaultChart: defaultChart,\n        startDate: startDate.format('DD.MM'),\n        finishDate: finishDate.format('DD.MM'),\n        loading: true\n      });\n    }\n  }, {\n    key: \"sortHoursChart\",\n    value: function sortHoursChart(userLogs) {\n      var dayData = [];\n      var startHour = moment('00:00', 'HH:mm');\n      var finishHour = moment('01:00', 'HH:mm');\n\n      for (var i = 0; i < 24; i++) {\n        var hourData = {\n          x: startHour.format('HH:mm'),\n          y: 0\n        };\n\n        for (var j = 0; j < userLogs.length; j++) {\n          var visitTime = moment(userLogs[j].time.slice(6, 11), 'HH:mm');\n\n          if (visitTime.isBetween(startHour, finishHour, 'hours', '[)')) {\n            hourData.y++;\n          }\n        }\n\n        dayData.push(hourData);\n        startHour = startHour.add(1, \"hours\");\n        finishHour = finishHour.add(1, \"hours\");\n      }\n\n      return dayData;\n    }\n  }, {\n    key: \"getAllLogs\",\n    value: function getAllLogs(userLogs) {\n      var allLogs = [];\n\n      for (var i = 0; i < userLogs.length; i++) {\n        var logItems = userLogs[i].logItems;\n\n        for (var j = 0; j < logItems.length; j++) {\n          allLogs.push(logItems[j]);\n        }\n      }\n\n      return allLogs;\n    }\n  }, {\n    key: \"getReports\",\n    value: function getReports(allLogs) {\n      var reports = [];\n\n      for (var i = 0; i < allLogs.length; i++) {\n        var presentLog = allLogs[i];\n        var havePresentLog = false;\n\n        for (var j = 0; j < reports.length; j++) {\n          if (presentLog.title === reports[j].name) {\n            havePresentLog = true;\n            reports[j].count++;\n          }\n        }\n\n        if (!havePresentLog) {\n          var addLogItem = {\n            name: presentLog.title,\n            color: COLORS[reports.length % 10],\n            link: presentLog.link,\n            display: true,\n            count: 1\n          };\n          reports.push(addLogItem);\n        }\n      }\n\n      return reports;\n    }\n  }, {\n    key: \"getDataReports\",\n    value: function getDataReports(listReports, allLogs) {\n      for (var i = 0; i < listReports.length; i++) {\n        var presentReport = listReports[i];\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(14, \"days\");\n        presentReport.monthData = [];\n\n        for (var j = 14; j > 0; j--) {\n          var visitsOnDay = 0;\n\n          for (var z = 0; z < allLogs.length; z++) {\n            if (allLogs[z].date == startDate.format('DD.MM') && allLogs[z].title === presentReport.name) {\n              visitsOnDay++;\n            }\n          }\n\n          var oneDayValue = {\n            x: startDate.format('DD.MM'),\n            y: visitsOnDay\n          };\n          startDate = startDate.add(1, \"days\");\n          presentReport.monthData.push(oneDayValue);\n        }\n      }\n\n      return listReports;\n    }\n  }, {\n    key: \"getDefaultChart\",\n    value: function getDefaultChart() {\n      var currentlyDate = moment(new Date(), 'DD.MM');\n      var startDate = currentlyDate.subtract(15, \"days\");\n      var defaultDays = [];\n\n      for (var i = 15; i > 0; i--) {\n        var oneDay = {\n          x: startDate.format('DD.MM'),\n          y: 0\n        };\n        startDate = startDate.add(1, \"days\");\n        defaultDays.push(oneDay);\n      }\n\n      return defaultDays;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"maskComponent\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, !this.state.loading ? React.createElement(Loader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }) : null, React.createElement(\"div\", {\n        className: \"sidebar\",\n        id: \"sidebar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, React.createElement(Navigation, {\n        activeItem: 7718,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"panel\",\n        id: \"panel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, React.createElement(ReportsWorkspace, {\n        chartReports: this.state.chartReports,\n        startDate: this.state.startDate,\n        finishDate: this.state.finishDate,\n        defaultChart: this.state.defaultChart,\n        settingPeriod: this.state.settingPeriod,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Reports;\n}(React.Component);\n\nexport default Reports;","map":{"version":3,"sources":["/Users/maksimzajcev/Desktop/Work/src/components/React.reports.js"],"names":["React","dataLoad","Navigation","Loader","moment","ReportsWorkspace","COLORS","urlLogs","Reports","props","setDate","changedDate","setState","loading","formatedDate","format","loadData","state","chartReports","startDate","finishDate","settingPeriod","Date","period","usersLogs","then","logs","catch","console","log","date","fetch","response","json","result","parseData","e","allLogs","getAllLogs","listReports","getReports","getDataReports","subtract","defaultChart","getDefaultChart","userLogs","dayData","startHour","finishHour","i","hourData","x","y","j","length","visitTime","time","slice","isBetween","push","add","logItems","reports","presentLog","havePresentLog","title","name","count","addLogItem","color","link","display","presentReport","currentlyDate","monthData","visitsOnDay","z","oneDayValue","defaultDays","oneDay","Component"],"mappings":";;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,oBAArB;AACA,OAAOC,UAAP,MAAuB,aAAvB;AACA,OAAOC,MAAP,MAAmB,gBAAnB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,gBAAP,MAA6B,2BAA7B;AACA,OAAO,iBAAP;AAEA,IAAMC,MAAM,GAAG,CACX,SADW,EAEX,SAFW,EAGX,SAHW,EAIX,SAJW,EAKX,SALW,EAMX,SANW,EAOX,SAPW,EAQX,SARW,EASX,SATW,EAUX,SAVW,CAAf;AAaA,IAAMC,OAAO,GAAG,4BAAhB;;IAEMC,O;;;;;AACF,mBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,iFAAMA,KAAN;;AADe,UAkEnBC,OAlEmB,GAkET,UAACC,WAAD,EAAiB;AACvB,YAAKC,QAAL,CAAc;AACVC,QAAAA,OAAO,EAAE;AADC,OAAd;;AAIA,UAAIC,YAAY,GAAGV,MAAM,CAACO,WAAD,EAAc,YAAd,CAAN,CAAkCI,MAAlC,CAAyC,YAAzC,CAAnB;;AACA,YAAKC,QAAL,CAAcF,YAAd;AACH,KAzEkB;;AAEf,UAAKG,KAAL,GAAa;AACTC,MAAAA,YAAY,EAAE,EADL;AAETC,MAAAA,SAAS,EAAE,EAFF;AAGTC,MAAAA,UAAU,EAAE,EAHH;AAITP,MAAAA,OAAO,EAAE,KAJA;AAKTQ,MAAAA,aAAa,EAAEjB,MAAM,CAAC,IAAIkB,IAAJ,EAAD,CAAN,CAAmBP,MAAnB,CAA0B,SAA1B;AALN,KAAb;AAFe;AASlB;;;;yCAEoB;AACjB,WAAKC,QAAL,CAAcT,OAAd,EAAuB,KAAKU,KAAL,CAAWI,aAAlC;AACH;;;6BAEQd,O,EAASgB,M,EAAQ;AAEtB,UAAIC,SAAJ;AAEAvB,MAAAA,QAAQ,CAACM,OAAO,GAAG,UAAV,GAAuBgB,MAAxB,CAAR,CAAwCE,IAAxC,CAA6C,UAAAC,IAAI,EAAI,CAGpD,CAHD,EAGGC,KAHH,CAGS,UAASD,IAAT,EAAe;AACpBE,QAAAA,OAAO,CAACC,GAAR,CAAY,WAAWH,IAAvB;AACH,OALD;AAMH;;;6BAQQI,I,EAAM;AAAA;;AACXF,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYC,IAAZ;AACAC,MAAAA,KAAK,CAACxB,OAAO,GAAG,UAAV,GAAuBgB,MAAxB,CAAL,CACKE,IADL,CACU,UAASO,QAAT,EAAmB;AACrBJ,QAAAA,OAAO,CAACC,GAAR,CAAYG,QAAZ;AACA,eAAOA,QAAQ,CAACC,IAAT,EAAP;AACH,OAJL,EAKKR,IALL,CAKU,UAAAS,MAAM;AAAA,eAAI,MAAI,CAACC,SAAL,CAAeD,MAAf,CAAJ;AAAA,OALhB,EAMKP,KANL,CAMW,UAAAS,CAAC;AAAA,eAAIR,OAAO,CAACC,GAAR,CAAYO,CAAZ,CAAJ;AAAA,OANZ;AAOH;;;8BAESZ,S,EAAW;AACjBI,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYL,SAAZ;AACA,UAAIa,OAAO,GAAG,KAAKC,UAAL,CAAgBd,SAAhB,CAAd;AACA,UAAIe,WAAW,GAAG,KAAKC,UAAL,CAAgBH,OAAhB,CAAlB;AACA,UAAInB,YAAY,GAAG,KAAKuB,cAAL,CAAoBF,WAApB,EAAiCF,OAAjC,CAAnB;AACAT,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYX,YAAZ;AACA,UAAIE,UAAU,GAAGhB,MAAM,CAAC,IAAIkB,IAAJ,EAAD,EAAa,OAAb,CAAN,CAA4BoB,QAA5B,CAAqC,CAArC,EAAwC,MAAxC,CAAjB;AACA,UAAIvB,SAAS,GAAGf,MAAM,CAAC,IAAIkB,IAAJ,EAAD,EAAa,OAAb,CAAN,CAA4BoB,QAA5B,CAAqC,EAArC,EAAyC,MAAzC,CAAhB;AACA,UAAIC,YAAY,GAAG,KAAKC,eAAL,EAAnB;AAEA,WAAKhC,QAAL,CAAc;AACVM,QAAAA,YAAY,EAAEA,YADJ;AAEVyB,QAAAA,YAAY,EAAEA,YAFJ;AAGVxB,QAAAA,SAAS,EAAEA,SAAS,CAACJ,MAAV,CAAiB,OAAjB,CAHD;AAIVK,QAAAA,UAAU,EAAEA,UAAU,CAACL,MAAX,CAAkB,OAAlB,CAJF;AAKVF,QAAAA,OAAO,EAAE;AALC,OAAd;AAOH;;;mCAecgC,Q,EAAU;AACrB,UAAIC,OAAO,GAAG,EAAd;AAEA,UAAIC,SAAS,GAAG3C,MAAM,CAAC,OAAD,EAAU,OAAV,CAAtB;AACA,UAAI4C,UAAU,GAAG5C,MAAM,CAAC,OAAD,EAAU,OAAV,CAAvB;;AAEA,WAAK,IAAI6C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB,YAAIC,QAAQ,GAAG;AACXC,UAAAA,CAAC,EAAEJ,SAAS,CAAChC,MAAV,CAAiB,OAAjB,CADQ;AAEXqC,UAAAA,CAAC,EAAE;AAFQ,SAAf;;AAKA,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,QAAQ,CAACS,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,cAAIE,SAAS,GAAGnD,MAAM,CAACyC,QAAQ,CAACQ,CAAD,CAAR,CAAYG,IAAZ,CAAiBC,KAAjB,CAAuB,CAAvB,EAAyB,EAAzB,CAAD,EAA+B,OAA/B,CAAtB;;AACA,cAAIF,SAAS,CAACG,SAAV,CAAoBX,SAApB,EAA+BC,UAA/B,EAA2C,OAA3C,EAAoD,IAApD,CAAJ,EAA+D;AAC3DE,YAAAA,QAAQ,CAACE,CAAT;AACH;AACJ;;AAEDN,QAAAA,OAAO,CAACa,IAAR,CAAaT,QAAb;AACAH,QAAAA,SAAS,GAAGA,SAAS,CAACa,GAAV,CAAc,CAAd,EAAiB,OAAjB,CAAZ;AACAZ,QAAAA,UAAU,GAAGA,UAAU,CAACY,GAAX,CAAe,CAAf,EAAkB,OAAlB,CAAb;AACH;;AAED,aAAOd,OAAP;AACH;;;+BAEUD,Q,EAAU;AACjB,UAAIR,OAAO,GAAG,EAAd;;AAEA,WAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,QAAQ,CAACS,MAA7B,EAAqCL,CAAC,EAAtC,EAA0C;AACtC,YAAIY,QAAQ,GAAGhB,QAAQ,CAACI,CAAD,CAAR,CAAYY,QAA3B;;AACA,aAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGQ,QAAQ,CAACP,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtChB,UAAAA,OAAO,CAACsB,IAAR,CAAaE,QAAQ,CAACR,CAAD,CAArB;AACH;AACJ;;AAED,aAAOhB,OAAP;AACH;;;+BAEUA,O,EAAS;AAChB,UAAIyB,OAAO,GAAG,EAAd;;AAEA,WAAK,IAAIb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,OAAO,CAACiB,MAA5B,EAAoCL,CAAC,EAArC,EAAyC;AACrC,YAAIc,UAAU,GAAG1B,OAAO,CAACY,CAAD,CAAxB;AACA,YAAIe,cAAc,GAAG,KAArB;;AACA,aAAK,IAAIX,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGS,OAAO,CAACR,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,cAAIU,UAAU,CAACE,KAAX,KAAqBH,OAAO,CAACT,CAAD,CAAP,CAAWa,IAApC,EAA0C;AACtCF,YAAAA,cAAc,GAAG,IAAjB;AACAF,YAAAA,OAAO,CAACT,CAAD,CAAP,CAAWc,KAAX;AACH;AACJ;;AACD,YAAI,CAACH,cAAL,EAAqB;AACjB,cAAII,UAAU,GAAG;AACbF,YAAAA,IAAI,EAAEH,UAAU,CAACE,KADJ;AAEbI,YAAAA,KAAK,EAAE/D,MAAM,CAACwD,OAAO,CAACR,MAAR,GAAiB,EAAlB,CAFA;AAGbgB,YAAAA,IAAI,EAAEP,UAAU,CAACO,IAHJ;AAIbC,YAAAA,OAAO,EAAE,IAJI;AAKbJ,YAAAA,KAAK,EAAE;AALM,WAAjB;AAQAL,UAAAA,OAAO,CAACH,IAAR,CAAaS,UAAb;AACH;AACJ;;AAED,aAAON,OAAP;AACH;;;mCAEcvB,W,EAAaF,O,EAAS;AAEjC,WAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,WAAW,CAACe,MAAhC,EAAwCL,CAAC,EAAzC,EAA6C;AACzC,YAAIuB,aAAa,GAAGjC,WAAW,CAACU,CAAD,CAA/B;AACA,YAAIwB,aAAa,GAAGrE,MAAM,CAAC,IAAIkB,IAAJ,EAAD,EAAa,OAAb,CAA1B;AACA,YAAIH,SAAS,GAAGsD,aAAa,CAAC/B,QAAd,CAAuB,EAAvB,EAA2B,MAA3B,CAAhB;AAEA8B,QAAAA,aAAa,CAACE,SAAd,GAA0B,EAA1B;;AAEA,aAAK,IAAIrB,CAAC,GAAG,EAAb,EAAiBA,CAAC,GAAG,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB,cAAIsB,WAAW,GAAG,CAAlB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvC,OAAO,CAACiB,MAA5B,EAAoCsB,CAAC,EAArC,EAAyC;AAErC,gBAAKvC,OAAO,CAACuC,CAAD,CAAP,CAAW9C,IAAX,IAAmBX,SAAS,CAACJ,MAAV,CAAiB,OAAjB,CAApB,IAAmDsB,OAAO,CAACuC,CAAD,CAAP,CAAWX,KAAX,KAAqBO,aAAa,CAACN,IAA1F,EAAiG;AAC7FS,cAAAA,WAAW;AACd;AACJ;;AAED,cAAIE,WAAW,GAAG;AACd1B,YAAAA,CAAC,EAAEhC,SAAS,CAACJ,MAAV,CAAiB,OAAjB,CADW;AAEdqC,YAAAA,CAAC,EAAEuB;AAFW,WAAlB;AAKAxD,UAAAA,SAAS,GAAGA,SAAS,CAACyC,GAAV,CAAc,CAAd,EAAiB,MAAjB,CAAZ;AACAY,UAAAA,aAAa,CAACE,SAAd,CAAwBf,IAAxB,CAA6BkB,WAA7B;AACH;AACJ;;AAED,aAAOtC,WAAP;AACH;;;sCAEiB;AACd,UAAIkC,aAAa,GAAGrE,MAAM,CAAC,IAAIkB,IAAJ,EAAD,EAAa,OAAb,CAA1B;AACA,UAAIH,SAAS,GAAGsD,aAAa,CAAC/B,QAAd,CAAuB,EAAvB,EAA2B,MAA3B,CAAhB;AACA,UAAIoC,WAAW,GAAG,EAAlB;;AAEA,WAAK,IAAI7B,CAAC,GAAG,EAAb,EAAiBA,CAAC,GAAG,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AAEzB,YAAI8B,MAAM,GAAG;AACT5B,UAAAA,CAAC,EAAEhC,SAAS,CAACJ,MAAV,CAAiB,OAAjB,CADM;AAETqC,UAAAA,CAAC,EAAE;AAFM,SAAb;AAKAjC,QAAAA,SAAS,GAAGA,SAAS,CAACyC,GAAV,CAAc,CAAd,EAAiB,MAAjB,CAAZ;AACAkB,QAAAA,WAAW,CAACnB,IAAZ,CAAiBoB,MAAjB;AACH;;AAED,aAAOD,WAAP;AACH;;;6BAEQ;AACL,aACI;AAAK,QAAA,EAAE,EAAC,eAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACK,CAAC,KAAK7D,KAAL,CAAWJ,OAAZ,GAAsB,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAtB,GAAmC,IADxC,EAEI;AAAK,QAAA,SAAS,EAAC,SAAf;AAAyB,QAAA,EAAE,EAAC,SAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,UAAD;AAAY,QAAA,UAAU,EAAE,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAFJ,EAKI;AAAK,QAAA,SAAS,EAAC,OAAf;AAAuB,QAAA,EAAE,EAAC,OAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,gBAAD;AACI,QAAA,YAAY,EAAE,KAAKI,KAAL,CAAWC,YAD7B;AAEI,QAAA,SAAS,EAAE,KAAKD,KAAL,CAAWE,SAF1B;AAGI,QAAA,UAAU,EAAE,KAAKF,KAAL,CAAWG,UAH3B;AAII,QAAA,YAAY,EAAE,KAAKH,KAAL,CAAW0B,YAJ7B;AAKI,QAAA,aAAa,EAAE,KAAK1B,KAAL,CAAWI,aAL9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CALJ,CADJ;AAiBH;;;;EAxNiBrB,KAAK,CAACgF,S;;AA2N5B,eAAexE,OAAf","sourcesContent":["import React from 'react';\nimport dataLoad from '../models/dataLoad';\nimport Navigation from './React.nav';\nimport Loader from './React.loader';\nimport moment from 'moment'\nimport ReportsWorkspace from './React.reports.workspace';\nimport '../css/main.css';\n\nconst COLORS = [\n    '#4461c2',\n    '#16a65e',\n    '#85d357',\n    '#ffdc45',\n    '#ff4716',\n    '#6ab4ec',\n    '#b63dbc',\n    '#fdaa19',\n    '#fcacfd',\n    '#8e8cd8'\n];\n\nconst urlLogs = 'http://localhost:3000/logs';\n\nclass Reports extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            chartReports: [],\n            startDate: '',\n            finishDate: '',\n            loading: false,\n            settingPeriod: moment(new Date()).format('MM.YYYY'),  \n        };\n    }\n\n    componentWillMount() {\n        this.loadData(urlLogs, this.state.settingPeriod);\n    }\n\n    loadData(urlLogs, period) {\n\n        var usersLogs;\n\n        dataLoad(urlLogs + '?period=' + period).then(logs => {\n            \n\n        }).catch(function(logs) {\n            console.log('error ' + logs);\n        })\n    }\n\n\n\n\n\n\n\n    loadData(date) {\n        console.log(\"Загружаемая дата:\");\n        console.log(date);\n        fetch(urlLogs + '?period=' + period)\n            .then(function(response) {\n                console.log(response);\n                return response.json();\n            })\n            .then(result => this.parseData(result))\n            .catch(e => console.log(e));\n    }\n\n    parseData(usersLogs) {\n        console.log('Пришедшие логи:');\n        console.log(usersLogs);\n        var allLogs = this.getAllLogs(usersLogs);\n        var listReports = this.getReports(allLogs);\n        var chartReports = this.getDataReports(listReports, allLogs);\n        console.log('Сформированные графики:');\n        console.log(chartReports);\n        var finishDate = moment(new Date(), 'DD.MM').subtract(1, \"days\");\n        var startDate = moment(new Date(), 'DD.MM').subtract(15, \"days\");\n        var defaultChart = this.getDefaultChart();\n\n        this.setState({\n            chartReports: chartReports,\n            defaultChart: defaultChart,\n            startDate: startDate.format('DD.MM'),\n            finishDate: finishDate.format('DD.MM'),\n            loading: true\n        });\n    }\n\n    setDate = (changedDate) => {\n        this.setState({\n            loading: false\n        });\n\n        var formatedDate = moment(changedDate, 'YYYY-MM-DD').format('DD.MM.YYYY');\n        this.loadData(formatedDate);\n    }\n\n\n\n\n\n    sortHoursChart(userLogs) {\n        var dayData = [];\n\n        var startHour = moment('00:00', 'HH:mm');\n        var finishHour = moment('01:00', 'HH:mm');\n\n        for (let i = 0; i < 24; i++) {\n            var hourData = {\n                x: startHour.format('HH:mm'),\n                y: 0\n            }\n\n            for (let j = 0; j < userLogs.length; j++) {\n                var visitTime = moment(userLogs[j].time.slice(6,11), 'HH:mm');\n                if (visitTime.isBetween(startHour, finishHour, 'hours', '[)')) {\n                    hourData.y++;\n                }\n            }\n\n            dayData.push(hourData);\n            startHour = startHour.add(1, \"hours\");\n            finishHour = finishHour.add(1, \"hours\");\n        }\n\n        return dayData;\n    }\n\n    getAllLogs(userLogs) {\n        var allLogs = [];\n\n        for (let i = 0; i < userLogs.length; i++) {\n            var logItems = userLogs[i].logItems;\n            for (let j = 0; j < logItems.length; j++) {\n                allLogs.push(logItems[j]);\n            }\n        }\n\n        return allLogs;\n    }\n\n    getReports(allLogs) {\n        var reports = [];\n\n        for (let i = 0; i < allLogs.length; i++) {\n            var presentLog = allLogs[i];\n            var havePresentLog = false;\n            for (let j = 0; j < reports.length; j++) {\n                if (presentLog.title === reports[j].name) {\n                    havePresentLog = true;\n                    reports[j].count++;\n                }\n            }\n            if (!havePresentLog) {\n                var addLogItem = {\n                    name: presentLog.title,\n                    color: COLORS[reports.length % 10],\n                    link: presentLog.link,\n                    display: true,\n                    count: 1\n                }\n\n                reports.push(addLogItem);\n            }\n        }\n\n        return reports;\n    }\n\n    getDataReports(listReports, allLogs) {\n\n        for (let i = 0; i < listReports.length; i++) {\n            var presentReport = listReports[i];\n            var currentlyDate = moment(new Date(), 'DD.MM');\n            var startDate = currentlyDate.subtract(14, \"days\");\n\n            presentReport.monthData = [];\n\n            for (let j = 14; j > 0; j--) {\n                var visitsOnDay = 0;\n                for (let z = 0; z < allLogs.length; z++) {\n\n                    if ((allLogs[z].date == startDate.format('DD.MM')) && (allLogs[z].title === presentReport.name)) {\n                        visitsOnDay++;\n                    }\n                }\n\n                var oneDayValue = {\n                    x: startDate.format('DD.MM'),\n                    y: visitsOnDay\n                };\n\n                startDate = startDate.add(1, \"days\");\n                presentReport.monthData.push(oneDayValue);\n            }\n        }\n\n        return listReports;\n    }\n\n    getDefaultChart() {\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(15, \"days\");\n        var defaultDays = [];\n\n        for (let i = 15; i > 0; i--) {\n\n            var oneDay = {\n                x: startDate.format('DD.MM'),\n                y: 0\n            };\n\n            startDate = startDate.add(1, \"days\");\n            defaultDays.push(oneDay);\n        }\n\n        return defaultDays;\n    }\n\n    render() {\n        return (\n            <div id=\"maskComponent\">\n                {!this.state.loading ? <Loader /> : null}\n                <div className=\"sidebar\" id=\"sidebar\">\n                    <Navigation activeItem={7718} />\n                </div>\n                <div className=\"panel\" id=\"panel\">\n                    <ReportsWorkspace\n                        chartReports={this.state.chartReports}\n                        startDate={this.state.startDate}\n                        finishDate={this.state.finishDate}\n                        defaultChart={this.state.defaultChart}\n                        settingPeriod={this.state.settingPeriod}\n                    />\n                </div>                        \n            </div>\n        );\n    }\n}\n\nexport default Reports;\n\n"]},"metadata":{},"sourceType":"module"}