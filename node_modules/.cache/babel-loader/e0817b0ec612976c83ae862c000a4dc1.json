{"ast":null,"code":"import _classCallCheck from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/maksimzajcev/Desktop/Work/src/components/React.mode.js\";\nimport React from 'react';\nimport dataLoad from '../models/dataLoad';\nimport Navigation from './React.nav';\nimport Loader from './React.loader';\nimport moment from 'moment';\nimport ModeWorkspace from './React.month.workspace';\nimport '../css/main.css';\n\nvar Mode =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Mode, _React$Component);\n\n  function Mode(props) {\n    var _this;\n\n    _classCallCheck(this, Mode);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Mode).call(this, props));\n    _this.state = {\n      charts: {},\n      defaultChart: [],\n      strainData: [],\n      startDate: '',\n      finishDate: '',\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(Mode, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loadData();\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData() {\n      var _this2 = this;\n\n      var urlVisits = 'http://localhost:3000/visits';\n      dataLoad(urlVisits).then(function (visits) {\n        visits = JSON.parse(visits);\n\n        var goodBegin = _this2.getGoodBeginData(visits);\n\n        console.log('Приходы во время:');\n        console.log(goodBegin);\n\n        var bedBegin = _this2.getBedBeginData(visits);\n\n        var goodEnd = _this2.getGoodEndData(visits);\n\n        var bedEnd = _this2.getBedEndData(visits);\n\n        var defaultChart = _this2.getDefaultChart();\n\n        var charts = {\n          goodBegin: {\n            chartId: 4501,\n            data: goodBegin,\n            display: true,\n            color: '#84c9f6'\n          },\n          bedBegin: {\n            chartId: 4502,\n            data: bedBegin,\n            display: true,\n            color: '#3fa6e9'\n          },\n          goodEnd: {\n            chartId: 4503,\n            data: goodEnd,\n            display: true,\n            color: '#127bbf'\n          },\n          bedEnd: {\n            chartId: 4504,\n            data: bedEnd,\n            display: true,\n            color: '#3fa6e9'\n          }\n        };\n        var finishDate = moment(new Date(), 'DD.MM').subtract(1, \"days\");\n        var startDate = moment(new Date(), 'DD.MM').subtract(30, \"days\");\n        var strainData = [];\n\n        for (var i = 0; i < 30; i++) {\n          var dayData = {\n            date: charts.users.data[i].x,\n            users: charts.users.data[i].y,\n            visits: charts.visits.data[i].y,\n            views: charts.views.data[i].y\n          };\n          strainData.push(dayData);\n        }\n\n        _this2.setState({\n          charts: charts,\n          defaultChart: defaultChart,\n          strainData: strainData,\n          startDate: startDate.format('DD.MM'),\n          finishDate: finishDate.format('DD.MM'),\n          loading: true\n        });\n      }).catch(function (logs) {\n        console.log('error ' + logs);\n      });\n    }\n  }, {\n    key: \"getGoodBeginData\",\n    value: function getGoodBeginData(visits) {\n      var currentlyDate = moment(new Date(), 'DD.MM.YYYY');\n      var startDate = currentlyDate.subtract(30, \"days\");\n      var monthData = [];\n\n      for (var i = 30; i > 0; i--) {\n        var goodBeginsOnDay = 0;\n\n        for (var j = 0; j < visits.length; j++) {\n          if (visits[j].date === startDate.format('DD.MM.YYYY') && moment(visits[j].beginTime, 'hh:mm').isBefore(visits[j].startTime, 'minute')) {\n            goodBeginsOnDay++;\n          }\n        }\n\n        var oneDayValue = {\n          x: startDate.format('DD.MM'),\n          y: goodBeginsOnDay\n        };\n        startDate = startDate.add(1, \"days\");\n        monthData.push(oneDayValue);\n      }\n\n      return monthData;\n    }\n  }, {\n    key: \"getBedBeginData\",\n    value: function getBedBeginData(visits) {\n      var currentlyDate = moment(new Date(), 'DD.MM');\n      var startDate = currentlyDate.subtract(30, \"days\");\n      var sortViews = [];\n\n      for (var i = 30; i > 0; i--) {\n        var viewsOnDay = 0;\n\n        for (var j = 0; j < visits.length; j++) {\n          if (visits[j].time.slice(0, 5) === startDate.format('DD.MM')) {\n            viewsOnDay = viewsOnDay + visits[j].pages;\n          }\n        }\n\n        var oneDayValue = {\n          x: startDate.format('DD.MM'),\n          y: viewsOnDay\n        };\n        startDate = startDate.add(1, \"days\");\n        sortViews.push(oneDayValue);\n      }\n\n      return sortViews;\n    }\n  }, {\n    key: \"getGoodEndData\",\n    value: function getGoodEndData(visits) {\n      var currentlyDate = moment(new Date(), 'DD.MM');\n      var startDate = currentlyDate.subtract(30, \"days\");\n      var sortUsers = [];\n\n      for (var i = 30; i > 0; i--) {\n        var uniqueUsers = [];\n\n        for (var j = 0; j < visits.length; j++) {\n          if (visits[j].time.slice(0, 5) === startDate.format('DD.MM') && !uniqueUsers.includes(visits[j].userId)) {\n            uniqueUsers.push(visits[j].userId);\n          }\n        }\n\n        var oneDay = {\n          x: startDate.format('DD.MM'),\n          y: uniqueUsers.length\n        };\n        startDate = startDate.add(1, \"days\");\n        sortUsers.push(oneDay);\n      }\n\n      return sortUsers;\n    }\n  }, {\n    key: \"getBedEndData\",\n    value: function getBedEndData(visits) {\n      var currentlyDate = moment(new Date(), 'DD.MM');\n      var startDate = currentlyDate.subtract(30, \"days\");\n      var sortUsers = [];\n\n      for (var i = 30; i > 0; i--) {\n        var uniqueUsers = [];\n\n        for (var j = 0; j < visits.length; j++) {\n          if (visits[j].time.slice(0, 5) === startDate.format('DD.MM') && !uniqueUsers.includes(userLogs[j].userId)) {\n            uniqueUsers.push(visits[j].userId);\n          }\n        }\n\n        var oneDay = {\n          x: startDate.format('DD.MM'),\n          y: uniqueUsers.length\n        };\n        startDate = startDate.add(1, \"days\");\n        sortUsers.push(oneDay);\n      }\n\n      return sortUsers;\n    }\n  }, {\n    key: \"getDefaultChart\",\n    value: function getDefaultChart() {\n      var currentlyDate = moment(new Date(), 'DD.MM');\n      var startDate = currentlyDate.subtract(30, \"days\");\n      var defaultDays = [];\n\n      for (var i = 30; i > 0; i--) {\n        var oneDay = {\n          x: startDate.format('DD.MM'),\n          y: 0\n        };\n        startDate = startDate.add(1, \"days\");\n        defaultDays.push(oneDay);\n      }\n\n      return defaultDays;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"maskComponent\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, !this.state.loading ? React.createElement(Loader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }) : null, React.createElement(\"div\", {\n        className: \"sidebar\",\n        id: \"sidebar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, React.createElement(Navigation, {\n        activeItem: 7717,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"panel\",\n        id: \"panel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, React.createElement(ModeWorkspace, {\n        charts: this.state.charts,\n        defaultChart: this.state.defaultChart,\n        strainData: this.state.strainData,\n        startDate: this.state.startDate,\n        finishDate: this.state.finishDate,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Mode;\n}(React.Component);\n\nexport default Mode;","map":{"version":3,"sources":["/Users/maksimzajcev/Desktop/Work/src/components/React.mode.js"],"names":["React","dataLoad","Navigation","Loader","moment","ModeWorkspace","Mode","props","state","charts","defaultChart","strainData","startDate","finishDate","loading","loadData","urlVisits","then","visits","JSON","parse","goodBegin","getGoodBeginData","console","log","bedBegin","getBedBeginData","goodEnd","getGoodEndData","bedEnd","getBedEndData","getDefaultChart","chartId","data","display","color","Date","subtract","i","dayData","date","users","x","y","views","push","setState","format","catch","logs","currentlyDate","monthData","goodBeginsOnDay","j","length","beginTime","isBefore","startTime","oneDayValue","add","sortViews","viewsOnDay","time","slice","pages","sortUsers","uniqueUsers","includes","userId","oneDay","userLogs","defaultDays","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport dataLoad from '../models/dataLoad';\nimport Navigation from './React.nav';\nimport Loader from './React.loader';\nimport moment from 'moment'\nimport ModeWorkspace from './React.month.workspace';\nimport '../css/main.css';\n\nclass Mode extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            charts: {},\n            defaultChart: [],\n            strainData: [],\n            startDate: '',\n            finishDate: '',\n            loading: false\n        };\n    }\n\n    componentDidMount() {\n        this.loadData();\n    }\n\n    loadData() {\n        var urlVisits = 'http://localhost:3000/visits';\n\n        dataLoad(urlVisits).then(visits => {\n            visits = JSON.parse(visits);\n            \n            var goodBegin = this.getGoodBeginData(visits);\n            console.log('Приходы во время:');\n            console.log(goodBegin);\n            var bedBegin = this.getBedBeginData(visits);\n            var goodEnd = this.getGoodEndData(visits);\n            var bedEnd = this.getBedEndData(visits);\n\n            var defaultChart = this.getDefaultChart();\n\n            var charts = {\n                goodBegin: {\n                    chartId: 4501,\n                    data: goodBegin,\n                    display: true,\n                    color: '#84c9f6'\n                },\n                bedBegin: {\n                    chartId: 4502,\n                    data: bedBegin,\n                    display: true,\n                    color: '#3fa6e9'\n                },\n                goodEnd: {\n                    chartId: 4503,\n                    data: goodEnd,\n                    display: true,\n                    color: '#127bbf'\n                },\n                bedEnd: {\n                    chartId: 4504,\n                    data: bedEnd,\n                    display: true,\n                    color: '#3fa6e9'\n                }\n            };\n\n            var finishDate = moment(new Date(), 'DD.MM').subtract(1, \"days\");\n            var startDate = moment(new Date(), 'DD.MM').subtract(30, \"days\");\n\n            var strainData = [];\n\n            for (let i = 0; i < 30; i++) {\n                var dayData = {\n                    date: charts.users.data[i].x,\n                    users: charts.users.data[i].y,\n                    visits: charts.visits.data[i].y,\n                    views: charts.views.data[i].y,\n                }\n\n                strainData.push(dayData);\n            }\n\n            this.setState({\n                charts: charts,\n                defaultChart: defaultChart,\n                strainData: strainData,\n                startDate: startDate.format('DD.MM'),\n                finishDate: finishDate.format('DD.MM'),\n                loading: true\n            });\n\n        }).catch(function(logs) {\n            console.log('error ' + logs);\n        })\n    }\n\n    getGoodBeginData(visits) {\n        var currentlyDate = moment(new Date(), 'DD.MM.YYYY');\n        var startDate = currentlyDate.subtract(30, \"days\");\n        var monthData = [];\n\n        for (let i = 30; i > 0; i--) {\n            var goodBeginsOnDay = 0;\n            for (let j = 0; j < visits.length; j++) {\n                if ((visits[j].date === startDate.format('DD.MM.YYYY')) && (moment(visits[j].beginTime, 'hh:mm').isBefore(visits[j].startTime, 'minute'))) {\n                    goodBeginsOnDay++;\n                }\n            }\n\n            var oneDayValue = {\n                x: startDate.format('DD.MM'),\n                y: goodBeginsOnDay\n            };\n\n            startDate = startDate.add(1, \"days\");\n            monthData.push(oneDayValue);\n        }\n\n        return monthData;\n    }\n\n    getBedBeginData(visits) {\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(30, \"days\");\n        var sortViews = [];\n\n        for (let i = 30; i > 0; i--) {\n            var viewsOnDay = 0;\n            for (let j = 0; j < visits.length; j++) {\n                if (visits[j].time.slice(0, 5) === startDate.format('DD.MM')) {\n                    viewsOnDay = viewsOnDay + visits[j].pages;\n                }\n            }\n\n            var oneDayValue = {\n                x: startDate.format('DD.MM'),\n                y: viewsOnDay\n            };\n\n            startDate = startDate.add(1, \"days\");\n            sortViews.push(oneDayValue);\n        }\n\n        return sortViews;\n    }\n\n    getGoodEndData(visits) {\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(30, \"days\");\n        var sortUsers = [];\n\n        for (let i = 30; i > 0; i--) {\n            var uniqueUsers = [];\n            \n            for (let j = 0; j < visits.length; j++) {\n                if ((visits[j].time.slice(0, 5) === startDate.format('DD.MM')) && (!uniqueUsers.includes(visits[j].userId))){\n                    uniqueUsers.push(visits[j].userId);\n                }\n            }\n\n            var oneDay = {\n                x: startDate.format('DD.MM'),\n                y: uniqueUsers.length\n            };\n\n            startDate = startDate.add(1, \"days\");\n            sortUsers.push(oneDay);\n        }\n\n        return sortUsers;\n    }\n\n    getBedEndData(visits) {\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(30, \"days\");\n        var sortUsers = [];\n\n        for (let i = 30; i > 0; i--) {\n            var uniqueUsers = [];\n            \n            for (let j = 0; j < visits.length; j++) {\n                if ((visits[j].time.slice(0, 5) === startDate.format('DD.MM')) && (!uniqueUsers.includes(userLogs[j].userId))){\n                    uniqueUsers.push(visits[j].userId);\n                }\n            }\n\n            var oneDay = {\n                x: startDate.format('DD.MM'),\n                y: uniqueUsers.length\n            };\n\n            startDate = startDate.add(1, \"days\");\n            sortUsers.push(oneDay);\n        }\n\n        return sortUsers;\n    }\n\n    getDefaultChart() {\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(30, \"days\");\n        var defaultDays = [];\n\n        for (let i = 30; i > 0; i--) {\n\n            var oneDay = {\n                x: startDate.format('DD.MM'),\n                y: 0\n            };\n\n            startDate = startDate.add(1, \"days\");\n            defaultDays.push(oneDay);\n        }\n\n        return defaultDays;\n    }\n\n    render() {\n        return (\n            <div id=\"maskComponent\">\n                {!this.state.loading ? <Loader /> : null}\n                <div className=\"sidebar\" id=\"sidebar\">\n                    <Navigation activeItem={7717} />\n                </div>\n                <div className=\"panel\" id=\"panel\">\n                    <ModeWorkspace\n                        charts={this.state.charts}\n                        defaultChart={this.state.defaultChart}\n                        strainData={this.state.strainData}\n                        startDate={this.state.startDate}\n                        finishDate={this.state.finishDate}\n                    />\n                </div>                        \n            </div>\n        );\n    }\n}\n\nexport default Mode;\n\n"]},"metadata":{},"sourceType":"module"}