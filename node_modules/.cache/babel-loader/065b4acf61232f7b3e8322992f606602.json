{"ast":null,"code":"import _classCallCheck from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/maksimzajcev/Desktop/Work/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/maksimzajcev/Desktop/Work/src/components/React.reports.js\";\nimport React from 'react';\nimport Navigation from './React.nav';\nimport Loader from './React.loader';\nimport moment from 'moment';\nimport ReportsWorkspace from './React.reports.workspace';\nimport '../css/main.css';\nvar COLORS = ['#4461c2', '#16a65e', '#85d357', '#ffdc45', '#ff4716', '#6ab4ec', '#b63dbc', '#fdaa19', '#fcacfd', '#8e8cd8'];\nvar urlLogs = 'http://localhost:3000/logs';\n\nvar Reports =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Reports, _React$Component);\n\n  function Reports(props) {\n    var _this;\n\n    _classCallCheck(this, Reports);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Reports).call(this, props));\n\n    _this.setPeriod = function (changedPeriod) {\n      _this.setState({\n        loading: false\n      });\n\n      _this.loadData(changedPeriod);\n    };\n\n    _this.state = {\n      chartReports: [],\n      startDate: '',\n      finishDate: '',\n      loading: false,\n      settingPeriod: moment(new Date()).format('MM.YYYY')\n    };\n    return _this;\n  }\n\n  _createClass(Reports, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.loadData(this.state.settingPeriod);\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData(period) {\n      var _this2 = this;\n\n      console.log(\"Загружаемый период:\");\n      console.log(period);\n      fetch(urlLogs + '?period=' + period).then(function (response) {\n        console.log(response);\n        return response.json();\n      }).then(function (result) {\n        return _this2.parseData(result, period);\n      }).catch(function (e) {\n        return console.log(e);\n      });\n    }\n  }, {\n    key: \"parseData\",\n    value: function parseData(usersLogs, period) {\n      console.log('Пришедшие логи:');\n      console.log(usersLogs);\n      var allLogs = this.getAllLogs(usersLogs);\n      var listReports = this.getReports(allLogs);\n      var chartReports = this.getDataReports(listReports, allLogs);\n      console.log('Сформированные графики:');\n      console.log(chartReports);\n      var startDate = moment('01.' + period.slice(0, 2), 'DD.MM');\n      var finishDate = moment('01.' + period.slice(0, 2), 'DD.MM').add(1, 'month');\n      var defaultChart = this.getDefaultChart();\n      this.setState({\n        chartReports: chartReports,\n        defaultChart: defaultChart,\n        startDate: startDate.format('DD.MM'),\n        finishDate: finishDate.format('DD.MM'),\n        loading: true\n      });\n    }\n  }, {\n    key: \"sortHoursChart\",\n    value: function sortHoursChart(userLogs) {\n      var dayData = [];\n      var startHour = moment('00:00', 'HH:mm');\n      var finishHour = moment('01:00', 'HH:mm');\n\n      for (var i = 0; i < 24; i++) {\n        var hourData = {\n          x: startHour.format('HH:mm'),\n          y: 0\n        };\n\n        for (var j = 0; j < userLogs.length; j++) {\n          var visitTime = moment(userLogs[j].time.slice(6, 11), 'HH:mm');\n\n          if (visitTime.isBetween(startHour, finishHour, 'hours', '[)')) {\n            hourData.y++;\n          }\n        }\n\n        dayData.push(hourData);\n        startHour = startHour.add(1, \"hours\");\n        finishHour = finishHour.add(1, \"hours\");\n      }\n\n      return dayData;\n    }\n  }, {\n    key: \"getAllLogs\",\n    value: function getAllLogs(userLogs) {\n      var allLogs = [];\n\n      for (var i = 0; i < userLogs.length; i++) {\n        var logItems = userLogs[i].logItems;\n\n        for (var j = 0; j < logItems.length; j++) {\n          allLogs.push(logItems[j]);\n        }\n      }\n\n      return allLogs;\n    }\n  }, {\n    key: \"getReports\",\n    value: function getReports(allLogs) {\n      var reports = [];\n\n      for (var i = 0; i < allLogs.length; i++) {\n        var presentLog = allLogs[i];\n        var havePresentLog = false;\n\n        for (var j = 0; j < reports.length; j++) {\n          if (presentLog.title === reports[j].name) {\n            havePresentLog = true;\n            reports[j].count++;\n          }\n        }\n\n        if (!havePresentLog) {\n          var addLogItem = {\n            name: presentLog.title,\n            color: COLORS[reports.length % 10],\n            link: presentLog.link,\n            display: true,\n            count: 1\n          };\n          reports.push(addLogItem);\n        }\n      }\n\n      return reports;\n    }\n  }, {\n    key: \"getDataReports\",\n    value: function getDataReports(listReports, allLogs) {\n      for (var i = 0; i < listReports.length; i++) {\n        var presentReport = listReports[i];\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(14, \"days\");\n        presentReport.monthData = [];\n\n        for (var j = 14; j > 0; j--) {\n          var visitsOnDay = 0;\n\n          for (var z = 0; z < allLogs.length; z++) {\n            if (allLogs[z].date == startDate.format('DD.MM') && allLogs[z].title === presentReport.name) {\n              visitsOnDay++;\n            }\n          }\n\n          var oneDayValue = {\n            x: startDate.format('DD.MM'),\n            y: visitsOnDay\n          };\n          startDate = startDate.add(1, \"days\");\n          presentReport.monthData.push(oneDayValue);\n        }\n      }\n\n      return listReports;\n    }\n  }, {\n    key: \"getDefaultChart\",\n    value: function getDefaultChart() {\n      var currentlyDate = moment(new Date(), 'DD.MM');\n      var startDate = currentlyDate.subtract(15, \"days\");\n      var defaultDays = [];\n\n      for (var i = 15; i > 0; i--) {\n        var oneDay = {\n          x: startDate.format('DD.MM'),\n          y: 0\n        };\n        startDate = startDate.add(1, \"days\");\n        defaultDays.push(oneDay);\n      }\n\n      return defaultDays;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"maskComponent\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, !this.state.loading ? React.createElement(Loader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202\n        },\n        __self: this\n      }) : null, React.createElement(\"div\", {\n        className: \"sidebar\",\n        id: \"sidebar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, React.createElement(Navigation, {\n        activeItem: 7718,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"panel\",\n        id: \"panel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(ReportsWorkspace, {\n        chartReports: this.state.chartReports,\n        startDate: this.state.startDate,\n        finishDate: this.state.finishDate,\n        defaultChart: this.state.defaultChart,\n        settingPeriod: this.state.settingPeriod,\n        setPeriod: this.setPeriod,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Reports;\n}(React.Component);\n\nexport default Reports;","map":{"version":3,"sources":["/Users/maksimzajcev/Desktop/Work/src/components/React.reports.js"],"names":["React","Navigation","Loader","moment","ReportsWorkspace","COLORS","urlLogs","Reports","props","setPeriod","changedPeriod","setState","loading","loadData","state","chartReports","startDate","finishDate","settingPeriod","Date","format","period","console","log","fetch","then","response","json","result","parseData","catch","e","usersLogs","allLogs","getAllLogs","listReports","getReports","getDataReports","slice","add","defaultChart","getDefaultChart","userLogs","dayData","startHour","finishHour","i","hourData","x","y","j","length","visitTime","time","isBetween","push","logItems","reports","presentLog","havePresentLog","title","name","count","addLogItem","color","link","display","presentReport","currentlyDate","subtract","monthData","visitsOnDay","z","date","oneDayValue","defaultDays","oneDay","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Navigation from './React.nav';\nimport Loader from './React.loader';\nimport moment from 'moment'\nimport ReportsWorkspace from './React.reports.workspace';\nimport '../css/main.css';\n\nconst COLORS = [\n    '#4461c2',\n    '#16a65e',\n    '#85d357',\n    '#ffdc45',\n    '#ff4716',\n    '#6ab4ec',\n    '#b63dbc',\n    '#fdaa19',\n    '#fcacfd',\n    '#8e8cd8'\n];\n\nconst urlLogs = 'http://localhost:3000/logs';\n\nclass Reports extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            chartReports: [],\n            startDate: '',\n            finishDate: '',\n            loading: false,\n            settingPeriod: moment(new Date()).format('MM.YYYY'),  \n        };\n    }\n\n    componentWillMount() {\n        this.loadData(this.state.settingPeriod);\n    }\n\n    loadData(period) {\n        console.log(\"Загружаемый период:\");\n        console.log(period);\n        fetch(urlLogs + '?period=' + period)\n            .then(function(response) {\n                console.log(response);\n                return response.json();\n            })\n            .then(result => this.parseData(result, period))\n            .catch(e => console.log(e));\n    }\n\n    parseData(usersLogs, period) {\n        console.log('Пришедшие логи:');\n        console.log(usersLogs);\n        var allLogs = this.getAllLogs(usersLogs);\n        var listReports = this.getReports(allLogs);\n        var chartReports = this.getDataReports(listReports, allLogs);\n        console.log('Сформированные графики:');\n        console.log(chartReports);\n        var startDate = moment('01.' + period.slice(0, 2), 'DD.MM');\n        var finishDate = moment('01.' + period.slice(0, 2), 'DD.MM').add(1, 'month');\n        \n        var defaultChart = this.getDefaultChart();\n\n        this.setState({\n            chartReports: chartReports,\n            defaultChart: defaultChart,\n            startDate: startDate.format('DD.MM'),\n            finishDate: finishDate.format('DD.MM'),\n            loading: true\n        });\n    }\n\n    setPeriod = (changedPeriod) => {\n        this.setState({\n            loading: false\n        });\n\n        this.loadData(changedPeriod);\n    }\n\n    sortHoursChart(userLogs) {\n        var dayData = [];\n\n        var startHour = moment('00:00', 'HH:mm');\n        var finishHour = moment('01:00', 'HH:mm');\n\n        for (let i = 0; i < 24; i++) {\n            var hourData = {\n                x: startHour.format('HH:mm'),\n                y: 0\n            }\n\n            for (let j = 0; j < userLogs.length; j++) {\n                var visitTime = moment(userLogs[j].time.slice(6,11), 'HH:mm');\n                if (visitTime.isBetween(startHour, finishHour, 'hours', '[)')) {\n                    hourData.y++;\n                }\n            }\n\n            dayData.push(hourData);\n            startHour = startHour.add(1, \"hours\");\n            finishHour = finishHour.add(1, \"hours\");\n        }\n\n        return dayData;\n    }\n\n    getAllLogs(userLogs) {\n        var allLogs = [];\n\n        for (let i = 0; i < userLogs.length; i++) {\n            var logItems = userLogs[i].logItems;\n            for (let j = 0; j < logItems.length; j++) {\n                allLogs.push(logItems[j]);\n            }\n        }\n\n        return allLogs;\n    }\n\n    getReports(allLogs) {\n        var reports = [];\n\n        for (let i = 0; i < allLogs.length; i++) {\n            var presentLog = allLogs[i];\n            var havePresentLog = false;\n            for (let j = 0; j < reports.length; j++) {\n                if (presentLog.title === reports[j].name) {\n                    havePresentLog = true;\n                    reports[j].count++;\n                }\n            }\n            if (!havePresentLog) {\n                var addLogItem = {\n                    name: presentLog.title,\n                    color: COLORS[reports.length % 10],\n                    link: presentLog.link,\n                    display: true,\n                    count: 1\n                }\n\n                reports.push(addLogItem);\n            }\n        }\n\n        return reports;\n    }\n\n    getDataReports(listReports, allLogs) {\n\n        for (let i = 0; i < listReports.length; i++) {\n            var presentReport = listReports[i];\n            var currentlyDate = moment(new Date(), 'DD.MM');\n            var startDate = currentlyDate.subtract(14, \"days\");\n\n            presentReport.monthData = [];\n\n            for (let j = 14; j > 0; j--) {\n                var visitsOnDay = 0;\n                for (let z = 0; z < allLogs.length; z++) {\n\n                    if ((allLogs[z].date == startDate.format('DD.MM')) && (allLogs[z].title === presentReport.name)) {\n                        visitsOnDay++;\n                    }\n                }\n\n                var oneDayValue = {\n                    x: startDate.format('DD.MM'),\n                    y: visitsOnDay\n                };\n\n                startDate = startDate.add(1, \"days\");\n                presentReport.monthData.push(oneDayValue);\n            }\n        }\n\n        return listReports;\n    }\n\n    getDefaultChart() {\n        var currentlyDate = moment(new Date(), 'DD.MM');\n        var startDate = currentlyDate.subtract(15, \"days\");\n        var defaultDays = [];\n\n        for (let i = 15; i > 0; i--) {\n\n            var oneDay = {\n                x: startDate.format('DD.MM'),\n                y: 0\n            };\n\n            startDate = startDate.add(1, \"days\");\n            defaultDays.push(oneDay);\n        }\n\n        return defaultDays;\n    }\n\n    render() {\n        return (\n            <div id=\"maskComponent\">\n                {!this.state.loading ? <Loader /> : null}\n                <div className=\"sidebar\" id=\"sidebar\">\n                    <Navigation activeItem={7718} />\n                </div>\n                <div className=\"panel\" id=\"panel\">\n                    <ReportsWorkspace\n                        chartReports={this.state.chartReports}\n                        startDate={this.state.startDate}\n                        finishDate={this.state.finishDate}\n                        defaultChart={this.state.defaultChart}\n                        settingPeriod={this.state.settingPeriod}\n                        setPeriod={this.setPeriod}\n                    />\n                </div>                        \n            </div>\n        );\n    }\n}\n\nexport default Reports;\n\n"]},"metadata":{},"sourceType":"module"}